{% extends 'base/main.html' %}
{% load static %}

{% block content %}

<!-- ============================================
     LOGIN PAGE
     ============================================ -->
<section class="auth-page">
  <!-- Background Decorations -->
  <div class="auth-bg-shapes">
    <div class="auth-shape auth-shape-1"></div>
    <div class="auth-shape auth-shape-2"></div>
    <div class="auth-shape auth-shape-3"></div>
  </div>

  <div class="auth-container">
    <!-- Left Side: Branding -->
    <div class="auth-branding">
      <!-- Scattered static paw prints -->
      <span class="auth-paw-scatter" style="top:5%;left:8%;font-size:8rem;opacity:0.18;transform:rotate(-20deg);">ğŸ¾</span>
      <span class="auth-paw-scatter" style="top:15%;left:62%;font-size:10rem;opacity:0.15;transform:rotate(30deg);">ğŸ¾</span>
      <span class="auth-paw-scatter" style="top:33%;left:2%;font-size:7rem;opacity:0.20;transform:rotate(10deg);">ğŸ¾</span>
      <span class="auth-paw-scatter" style="top:52%;left:72%;font-size:9rem;opacity:0.14;transform:rotate(-45deg);">ğŸ¾</span>
      <span class="auth-paw-scatter" style="top:65%;left:20%;font-size:11rem;opacity:0.17;transform:rotate(55deg);">ğŸ¾</span>
      <span class="auth-paw-scatter" style="top:78%;left:55%;font-size:8rem;opacity:0.16;transform:rotate(-30deg);">ğŸ¾</span>
      <span class="auth-paw-scatter" style="top:88%;left:5%;font-size:7rem;opacity:0.18;transform:rotate(15deg);">ğŸ¾</span>
      <span class="auth-paw-scatter" style="top:42%;left:40%;font-size:9rem;opacity:0.12;transform:rotate(-60deg);">ğŸ¾</span>

      <div class="auth-branding-content">
        <a href="{% url 'landing_page' %}" class="auth-logo">
          <img src="{% static 'image/fmh-logo.png' %}" alt="FMH Logo" class="auth-logo-img">
          <span>FMHSYNC</span>
        </a>
        
        <a href="{% url 'landing_page' %}" class="auth-home-btn"><i class='bx bx-arrow-back'></i> Return Home</a>
        
        <h1>Welcome Back!</h1>
        <p>Access your pet's medical records, upcoming appointments, and AI-powered health insights all in one place.</p>
        
        <div class="auth-features">
          <div class="auth-feature">
            <i class='bx bx-calendar-check'></i>
            <span>Manage Appointments</span>
          </div>
          <div class="auth-feature">
            <i class='bx bx-folder-open'></i>
            <span>View Medical Records</span>
          </div>
          <div class="auth-feature">
            <i class='bx bx-brain'></i>
            <span>AI Health Insights</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side: Login Form -->
    <div class="auth-form-section">
      <div class="auth-form-wrapper">
        <div class="auth-form-header">
          <h2>Sign In</h2>
          <p>Enter your credentials to access your account</p>
        </div>

        {% if messages %}
        <div class="auth-messages">
          {% for message in messages %}
          <div class="auth-message {{ message.tags }}">
            <i class='bx {% if message.tags == "error" %}bx-error-circle{% else %}bx-check-circle{% endif %}'></i>
            {{ message }}
          </div>
          {% endfor %}
        </div>
        {% endif %}

        <form id="loginForm" class="auth-form" method="POST" action="{% url 'login_page' %}" novalidate>
          {% csrf_token %}
          
          <div class="auth-form-group">
            <label for="username">Username</label>
            <div class="auth-input-wrapper">
              <i class='bx bx-user'></i>
              <input type="text" id="username" name="username" placeholder="Enter your username" required autocomplete="username">
            </div>
          </div>

          <div class="auth-form-group">
            <label for="password">Password</label>
            <div class="auth-input-wrapper">
              <i class='bx bx-lock-alt'></i>
              <input type="password" id="password" name="password" placeholder="Enter your password" required autocomplete="current-password">
              <button type="button" class="password-toggle" aria-label="Toggle password visibility">
                <i class='bx bx-hide'></i>
              </button>
            </div>
          </div>

          <div class="auth-form-options">
            <label class="auth-checkbox">
              <input type="checkbox" name="remember">
              <span class="checkmark"></span>
              Remember me
            </label>
            <a href="#" class="auth-forgot">Forgot Password?</a>
          </div>

          <button type="submit" class="btn btn-primary btn-lg auth-submit">
            <span>Sign In</span>
            <i class='bx bx-right-arrow-alt'></i>
          </button>
        </form>

        <div class="auth-footer">
          <p>Don't have an account? <a href="{% url 'register_page' %}">Create Account</a></p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Password toggle
  const passwordToggle = document.querySelector('.password-toggle');
  const passwordInput = document.getElementById('password');
  
  if (passwordToggle && passwordInput) {
    passwordToggle.addEventListener('click', function() {
      const icon = this.querySelector('i');
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.classList.remove('bx-hide');
        icon.classList.add('bx-show');
      } else {
        passwordInput.type = 'password';
        icon.classList.remove('bx-show');
        icon.classList.add('bx-hide');
      }
    });
  }

  // Form submission â€” validates then submits to Django
  const loginForm = document.getElementById('loginForm');
  if (loginForm) {
    loginForm.addEventListener('submit', function(e) {
      const username = document.getElementById('username');
      const password = document.getElementById('password');
      let hasError = false;

      // Clear previous errors
      document.querySelectorAll('.auth-error').forEach(el => el.remove());
      document.querySelectorAll('.auth-input-wrapper.error').forEach(el => el.classList.remove('error'));

      if (!username.value.trim()) {
        e.preventDefault();
        showError(username, 'Please enter your username');
        hasError = true;
      }

      if (!password.value) {
        e.preventDefault();
        showError(password, 'Please enter your password');
        hasError = true;
      }

      if (!hasError) {
        // Show loading state â€” form will submit naturally to Django
        const submitBtn = loginForm.querySelector('.auth-submit');
        submitBtn.classList.add('loading');
        submitBtn.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Signing In...';
      }
    });
  }

  function showError(input, message) {
    const wrapper = input.closest('.auth-input-wrapper');
    wrapper.classList.add('error');
    const error = document.createElement('span');
    error.className = 'auth-error';
    error.textContent = message;
    wrapper.parentNode.appendChild(error);
  }
});
</script>

{% endblock %}
