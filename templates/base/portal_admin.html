{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Admin Dashboard{% endblock %} â€” FMHSYNC</title>
  <link rel="icon" type="image/png" href="{% static 'image/fmh-logo.png' %}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/base/messages.css' %}">
  <link rel="stylesheet" href="{% static 'css/accounts/portal.css' %}">
</head>
<body>

<!-- Global Toast Messages -->
{% if messages %}
<div class="portal-messages" id="portalMessages">
  {% for message in messages %}
  <div class="portal-message {{ message.tags }}">
    {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}<i class='bx bx-check-circle'></i>
    {% elif message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}<i class='bx bx-error-circle'></i>
    {% elif message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}<i class='bx bx-error-alt'></i>
    {% else %}<i class='bx bx-info-circle'></i>{% endif %}
    <span>{{ message }}</span>
    <button class="portal-message-close" onclick="this.parentElement.remove()"><i class='bx bx-x'></i></button>
  </div>
  {% endfor %}
</div>
{% endif %}
<div class="portal-wrapper" id="portalWrapper">
  <div class="mobile-overlay" id="mobileOverlay"></div>

  <!-- ====== TOP NAVBAR (full width) ====== -->
  <header class="topbar">
    <div class="topbar-left">
      <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <i class='bx bx-menu'></i>
      </button>
      <a href="{% url 'admin_dashboard' %}" class="topbar-logo">
        <img src="{% static 'image/fmh-logo.png' %}" alt="FMH Logo">
        <span>FMHSYNC</span>
      </a>
    </div>

    <div class="topbar-center">
    </div>

    <div class="topbar-right">

      <a href="{% url 'landing_page' %}" class="topbar-icon-btn" title="Home">
        <i class='bx bx-home-alt'></i>
      </a>
      <button class="topbar-icon-btn" title="Notifications">
        <i class='bx bx-bell'></i>
        <span class="notif-dot"></span>
      </button>
      <button class="topbar-icon-btn" title="Theme">
        <i class='bx bx-sun'></i>
      </button>
      <div class="topbar-profile-container">
        <div class="topbar-profile" id="profileDropdownBtn" title="{{ user.get_full_name|default:user.username }}">
          <div class="topbar-avatar">
            {% if user.first_name %}
              {{ user.first_name|make_list|first|upper }}
            {% elif user.username %}
              {{ user.username|make_list|first|upper }}
            {% else %}
              <i class='bx bxs-user'></i>
            {% endif %}
          </div>
          <span class="topbar-name">{{ user.get_full_name|default:user.username }}</span>
          <i class='bx bx-chevron-down topbar-chevron'></i>
        </div>
        
        <!-- Profile Dropdown Menu -->
        <div class="topbar-dropdown" id="profileDropdown">
          <div class="dropdown-header">
            <div class="topbar-avatar large">
              {% if user.first_name %}
                {{ user.first_name|make_list|first|upper }}
              {% elif user.username %}
                {{ user.username|make_list|first|upper }}
              {% else %}
                <i class='bx bxs-user'></i>
              {% endif %}
            </div>
            <div class="dropdown-user-info">
              <strong>{{ user.get_full_name|default:user.username }}</strong>
              <span>{{ user.email }}</span>
              <span class="role-badge">{{ user.get_role_display }}</span>
            </div>
          </div>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
             <i class='bx bx-user'></i> My Profile
          </a>
          <a href="#" class="dropdown-item">
            <i class='bx bx-cog'></i> Settings
          </a>
          <div class="dropdown-divider"></div>
          <form action="{% url 'logout' %}" method="post" class="dropdown-logout-form">
            {% csrf_token %}
            <button type="submit" class="dropdown-item text-danger">
              <i class='bx bx-log-out'></i> Log Out
            </button>
          </form>
        </div>
      </div>
    </div>
  </header>

  <!-- ====== LEFT SIDEBAR ====== -->
  <aside class="sidebar">
    <nav class="sidebar-nav">
      <a href="{% url 'admin_dashboard' %}" class="sidebar-link {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}">
        <i class='bx bx-grid-alt'></i><span>Dashboard</span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_appointments' %}active{% endif %}">
        <i class='bx bx-calendar-check'></i><span>Appointments</span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_patients' %}active{% endif %}">
        <i class='bx bxs-dog'></i><span>Patients</span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_records' %}active{% endif %}">
        <i class='bx bx-file'></i><span>Records</span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_finance' %}active{% endif %}">
        <i class='bx bx-wallet'></i><span>Finance</span>
        <span class="submenu-arrow"><i class='bx bx-chevron-right'></i></span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_notifications' %}active{% endif %}">
        <i class='bx bx-bell'></i><span>Notifications</span>
        <span class="badge">5</span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_staff' %}active{% endif %}">
        <i class='bx bx-group'></i><span>Staff</span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_settings' %}active{% endif %}">
        <i class='bx bx-cog'></i><span>Settings</span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_inventory' %}active{% endif %}">
        <i class='bx bx-package'></i><span>Inventory</span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_ai' %}active{% endif %}">
        <i class='bx bx-brain'></i><span>AI Diagnostics</span>
      </a>
      <a href="#" class="sidebar-link {% if request.resolver_match.url_name == 'admin_branches' %}active{% endif %}">
        <i class='bx bx-building-house'></i><span>Branches</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <a href="{% url 'logout' %}" class="sidebar-link">
        <i class='bx bx-log-out'></i><span>Logout</span>
      </a>
    </div>
  </aside>

  <!-- ====== CONTENT ====== -->
  <main class="portal-content">
    {% block content %}{% endblock %}
  </main>
</div>

<!-- Portal JS -->
<script src="{% static 'js/accounts/portal.js' %}"></script>
<!-- Global Messages JS -->
<script src="{% static 'js/base/messages.js' %}"></script>
</body>
</html>
